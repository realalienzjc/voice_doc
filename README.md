# 语音对话系统的数据整理和分析报告[^1]

[^1]: Q:为什么使用Markdown格式的文档？ A: 因为便于文档的版本控制(比如：做差异比较)，而且是广泛使用的软件文档格式。请使用Markdown编辑/查看工具来查看，比如：\\192.168.1.36\share\技术部\softwares软件\Texts-0.20.1.msi

最后更新日期： 2014.8.7     
数据最后采集： 2014.8.5 ca. 9:00 A.M.


## 摘要  


"订餐小秘书"app的语音对话系统在版本2.4.8后上线，为了对产品做持续迭代(验证式学习，功能增减，UI改善，交互改进等)，本文档包括现有数据做初步分析、整理，以便团队信息共享，互相合作。目标阅读者主要是管理者、数据分析员或程序员。    
    
文档主要内容包括：   

* 现有数据的观察和理解;   
* 现有数据的整理、分析步骤说明;   
* 想法、改进意见;     


##重要信息源
  
* 讯飞的后台统计功能     
概述：讯飞语音云提供的基于语音组件的，用户使用情况分析。统计只统计使用app的用户数量，没有对语音对话内容进行分析整理，所以需要小秘书后台做额外的动作。   
链接：登录<http://open.voicecloud.cn/> ，查看“我的语音云->我的应用->订餐小秘书2”   
Updated:    
2014.8.6 zjc: 讯飞语音8.5无数据统计，原因不详；

		朱嘉诚: 数据报表类似于SEO分析，但本人对指标的意义不甚了解，希望做过报表分析的同事指点



* 小秘书后台的语音统计    
数据库表：数据接口reportVoice对应的数据库表     
接口字段说明 [reportVoice接口描述](###reportVoice接口描述) 



* 语音入口按钮的点击流     
"语音按钮", "设置按钮"的统计
概述：统计用户点击了多少次语音按钮  
注意：因为在添加点击流的时候，没有考虑到app其他语音入口也使用语音对话的组件，导致所有语音入口都


##数据的观察和理解(验证式学习)

> 说明：   
> 无指导下探索性分析。   
> 数据整理尚无法做成自动连续运行组件，需手动操作。

* **观察：**从讯飞的后台统计看， “应用趋势->服务统计”中看，只有“听写”的数据，没有"识别"的数据。  
  **理解：**手机端语音服务设置项，“domain”为"iat"则表示“普通文本转写”， “asr_sch”为"1"则表示“需要进行语义识别”。小秘书配置项均为该设定。小秘书的内置数据统计现实有“对话语音”  
  **结论：**讯飞的后台的该项统计可能不准确。或是：讯飞语音上登记的app未上线则不提供数据？(8.5上线)；


* **统计：**说话次数。从2014.7.27带语音功能上线后，截至2014.8.5上午。根据小秘书app的内部语音数据搜集，大概有726到840回连续对话，平均对话4.00条(包含小秘书发起的对话)，中位数5.42条。（数据来源：本地数据分析；注意：仅依据会话时间间隔，不是依据用户token。）    
   另外，考虑到用户初学时的空输入或是语义服务网络失败等导致的app提示语句，这里再次清理小秘书app发起的对话(带有"{GUIDE}")和用户无效输入(输入信息过短<4、脏话)后再次统计，得出： 平均用户说话：1.787条，中位数1.000条；  
  **理解：**可能表示用户没有足够的意愿进行语音查询。这和之前公司内部的面对面调查的结论类似，可能的原因有，“UI操作复杂”,"兴趣点不够(没显示出比Siri牛的地方)","有趣的互动过少"等；


* **观察：**用户的说话内容，见导出的文件reports/user_talks.txt   
  **理解：**    
  (a) 用户有说“外卖”的想法；   
  (b) 普遍在尝试第一个设想的需求未果后，不再尝试其他；    
  (c) 非上海地区缺少榜单，所以无法提供“适合情侣约会,过圣诞节”的特殊服务，而且没有做tagging搜索，场景服务是仅限上海地区；    
  (d) 特定场景不是用户常用的搜索条件，可能需要app加强引导；  
  (e) 用户需求比较简单，主要集中在：商户名，地点查询。所以，需要分别对地名，商户名，分别以文字，语音形式，分别测算多数用户使用，讯飞解析的成功比率；    
  (x) etc（需要更多解释）；   


* **统计：**不同地区，使用语音对话的用户说话次数的日期分布，见reports/users_talks_only__barchart.png；
  **理解：**    
  (a) 语音对话主要的功能，主要针对上海用户，所以几乎没有用上海以外的餐厅名，路名等槽点信息进行用户体验的试验；    
  (x) 从图和数据看，可能需要针对用户的说话内容，做对应改进；   


* **统计：**测算“每回对话用户耗时”：Min(2.427s), Median(32.507s), Mean(44.307s), Max(274.320s)；   
  测算“每次用户对话耗时(两次对话间隔)”：Min(1.214s), Median(11.449s), Mean(12.811s), Max(40.121s)；    
  注意：这里只统计了用户超过一次对话的数据(少于等于一次对话，认为没有停留在语音功能，也无法测算每次对话耗时)。见scripts/user_talks_areas.R    
  **理解：**     
  “每回对话耗时”，可以大概说明：用户在语音功能的大约停留时间；     
  “每次用户对话耗时”，可以大概说明：用户的说话节奏；两者相处，可以得出用户说话平均控制在4句话内。    
  可能说明：    
  a) 用户每次使用语音对话，只解决一个需求，可以结合“用户的说话内容”判断，这要求软件以最短路径捕获用户需求，而且针对唯一一个需求，要尽可能保证体验达标;    


* [更多补充]

##数据整理步骤   

> 说明：  
> 数据整理分两套：目前针对没有用户token的情况，做额外处理，归并可能是同一用户的对话； 当有用户token数据后，直接可以使用token来准确判断使用用户数。 

* 从后台开发人员处，获得导出的数据，比如：文件名为yuyin.csv。注意：数据最后采集日期;
* 从原始数据中，提取有用的数据(产品上线后的数据)，因为原始数据包含开发测试数据。运行clean.R，获得clean.csv;
* 由于2014.8.5晚为止的数据，尚未记录用户token，无法直接通过字段token识别用户数量，需要使用脚本来计算场景个数，执行raw_users_count.rb，获得converse.yml(内容：汇总对话后的对象，文件格式存储，可以装载到内存后再分析)，注意：converse_timeout300.yml中的"300"，表示"小于300秒且城市cityId相同，认为是同一个用户会话"，前提假设是“在非密集对话时”成立；





##数据分析步骤

说明：由于使用多种语言的脚本做分析，请参考文件：raw_ananlysis.rb

* 对话回数统计、平均对话次数的统计；
* 只包含用户说话内容的条目统计、平均对话次数的统计；
* 到处只含有用户说话内容的文本，查看文本内容来理解用户意图和可能的障碍；
* 分析不同区域下，用户说话内容多少的频率分布
  


##TODO 要修复的问题：
       
* reportUserLastSayToBackend方法中，参数错误：EmReportTag_ConverseByApp ，应为EmReportTag_ConverseByUser,便于数据分析（客户端）;
* ~~reportVoice接口对应的数据表格，需要增加token字段，便于数据分析（服务器端，已完成）~~;
* "语音入口按钮的点击流"点击流的登记位置不对，所有讯飞的语音入口均进入统计，无法分辨是否是“语音订餐对话”（客户端）;
* 需要在onXsMainTopBtnYyBtnClicked中增加点击流事件项，便于统计进入“语音订餐对话”的客户数量（客户端）,是否考虑增加更多点击流事件




##Post-mortems

* 程序组件在制作时，尽量写测试类(BDD之类可以检查/验证预期结果；加强数据的验证，减轻测试前后台手动测试的强度)






##附录


###reportVoice接口描述
接口名: reportVoice      
参数: tag ，content     
其中:    
tag的取值：EmReportTag_ConverseByApp = 1, EmReportTag_ConverseByUser = 2, EmReportTag_RestLists = 3, EmReportTag_TouchOnOneRest = 4, EmReportTag_Unknown = 5

### reportVoice接口对应的数据表格描述
其他字段：    
序号(id),    
城市号(CityId),    
(SendType),     
内容(ContentType)
条目创建日期(CreateTime)
设备标识(token)


